{% extends "base.html" %}
{% load url from future %}
{% load i18n %}
{% block extra_jq_ready %}
    var $user_draws = $('#my-draws').dataTable(
        {
            "bJQueryUI": true,
            "language" : {
                "emptyTable":     "{% trans 'No data available in table'%}",
                "info":           "{% trans 'Showing _START_ to _END_ of _TOTAL_ entries'%}",
                "infoEmpty":      "{% trans 'Showing 0 to 0 of 0 entries'%}",
                "infoFiltered":   "{% trans '(filtered from _MAX_ total entries)'%}",
                "thousands":      "{% trans ','%}",
                "lengthMenu":     "{% trans 'Show _MENU_ entries'%}",
                "loadingRecords": "{% trans 'Loading...'%}",
                "processing":     "{% trans 'Processing...'%}",
                "search":         "{% trans 'Search:'%}",
                "zeroRecords":    "{% trans 'No matching records found'%}",
                "paginate": {
                    "first":      "{% trans 'First'%}",
                    "last":       "{% trans 'Last'%}",
                    "next":       "{% trans 'Next'%}",
                    "previous":   "{% trans 'Previous'%}"
                },
                "aria": {
                    "sortAscending":  "{% trans ': activate to sort column ascending'%}",
                    "sortDescending": "{% trans ': activate to sort column descending'%}"
                }
            },
            "order": [[ 1, "desc" ]],
            "columnDefs": [
                { "targets": 0, "width": 12, "sortable": true },
                { "targets": 1, "sortable": true },
                { "targets": 2, "width": 120 },
                { "targets": 3, "width": 80 },
                { "targets": 4, "visible": false}
            ]
        }
    );

    $('#my-draws_wrapper').easDataTable({
        "type": "profile",
        "dataTable_plugin": $user_draws,
        "msg_your_draws": "{% trans "Show only your public draws" %}",
        "msg_search": "{% trans "Search" %}..."
    });

    $('#my-draws').on( 'click', 'tr', function () {
        if(!($(this).attr('alt')))
            return true;

        window.location = $(this).attr('alt');
    } );

{% endblock extra_jq_ready %}

{% block content %}
    <div id="profile">
        <h1>{% trans "Control Panel" %}</h1>
        <a id="edit-profile" href="{% url 'edit_profile' %}" class="btn btn-default">{% trans "Edit Profile" %}</a>
        {%if draws.owner %}<h2>{% trans "Draws' history" %}:</h2>{% endif %}
        <table id="my-draws" class="data-table" width="100%" cellspacing="0">
            <thead>
                <tr>
                    <th></th>
                    <th>{%trans 'Draw Name' %}</th>
                    <th>{%trans 'Created on' %}</th>
                    <th>{%trans '# results' %}</th>
                    <th>is_public</th>
                </tr>
            </thead>
            <tbody>
            {% for d in draws.owner reversed%}
                <tr alt="{% url 'retrieve_draw' draw_id=d.pk %}" style="cursor: pointer;">
                    <td class="text-right">{% if not d.shared_type  %}
                            <span class="fa fa-user" title="{% trans 'Private draw' %}"></span>
                        {% else %}
                            <span class="fa fa-globe" title="{% trans 'Public draw' %}"></span>
                        {% endif %}
                    </td>
                    <td>{{ d.title }}</td>
                    <td>{{d.creation_time|date:" Y/m/d G:i "}}</td>
                    <td>{{d.results | length}}</td>
                    <td>{% if d.shared_type  %}y{% endif %}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
        <hr/>
        <a id="sign-out" href="{% url 'login' %}" class="btn btn-default">{% trans "Sign out" %}</a>
    </div>
{% endblock %}
