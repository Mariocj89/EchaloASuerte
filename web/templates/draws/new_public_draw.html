{% extends "base.html" %}
{% load staticfiles %}
{% load crispy_forms_tags %}
{% load i18n %}
{% block title %}{% trans 'New Draw'  %} | {% endblock title %}
{#
    variables: draw_type, is_public, default_title
    add messages from user.messages (puedes meter aqui los info y no te hace falta draw_type)
    dinamically advance breadcrum
#}
{% block extra_head %}
    <script src="{% static 'js/autoGrowArea.js' %}"></script>
    <script src="{% static 'js/favourites.js' %}"></script>
    {% if is_public %}
        <script src="{% static 'js/moment.js' %}"></script>
        <script src="{% static 'js/slideSelector.js' %}"></script>
        <link href="{% static 'css/slideSelector.css' %}" rel="stylesheet">
        <script src="{% static 'js/public_draw_manager.js' %}"></script>
        <script src="{% static 'js/chat.js' %}"></script>
        <link href="{% static 'css/chat.css' %}" rel="stylesheet" />
    {% endif %}
    {% block draw_extra_head %}{% endblock draw_extra_head %}
{% endblock extra_head %}
{% block extra_jq_ready %}

    {% block draw_extra_jq_ready %}{% endblock draw_extra_jq_ready %}

    // When fields are focused, all the content is pre-selected
    $('.form-control').click(function() {
        var attr = $(this).hasClass('protected');
    console.log(attr);
        if (typeof attr === typeof undefined || attr === false) {
            $(this).select();
        }
    });

    // Autoresize the title box when window is resized
    autosize = function(){
        var max_width = $("#draw-title-container").width()*2/3;
        $("textarea.autogrow").width(max_width);
        $("textarea.autogrow").autoGrowInput({title:'{{ default_title }}',maxWidth: max_width,minWidth:30,comfortZone:30});
    };

    // Autosize the title box the first time
    autosize();
    $( window ).resize(function() {
        // Autosize when the window is resized
        autosize();
    });

    // Disable submit button after submitting
    $('form').submit(function() {
        $(this).find("button[type='submit']").prop('disabled',true);
        return true;
    });

    $('.accordion').accordion({collapsible: true});

    {% if is_public %}
        PublicDraw.setup("{{ public_draw_step }}");
    {% endif %}
{% endblock extra_jq_ready %}
{% block content %}
    {# breadcrumb to assist the creation of a public draw #}
    {% include "snippets/snippet_breadcrumb.html" %}
    <form class="clearfix" method="post">
        <!-- Draw Heading -->
        <div class="clearfix draw-heading">
            <a href="{% url 'index' %}" class="back-arrow col-xs-2 col-sm-2 text-center">
                <img src="{% static "img/back_arrow.png" %}"/>
            </a>
            <div class="col-xs-8 visible-xs"></div>
            <div class="hidden-xs col-xs-2 col-sm-2 col-sm-push-8"></div>
            <div id="draw-title-container" class="col-xs-12 col-sm-8 col-sm-pull-2 text-center">
                <textarea name="title" class="form-control autogrow draw-title-area text-center" rows="1">{{ default_title }}</textarea>
            </div>
        </div>
        <!-- End Draw Heading -->
        {% if is_public %}
            {#% if public_draw_step == "configure" or public_draw_step == "spread" %#}
                <!-- Inputs to configure the public draw, only rendered for configure and spread steps -->
                <div class="step-spread col-xs-12">
                    <div class="public-draw-restriction col-xs-12 col-md-8 col-md-offset-2">
                        <div class="col-xs-6">
                            <p class="h4">{% trans "Who can access your draw?" %} </p>
                        </div>
                        <div class="col-xs-6 text-center">
                            <a data-toggle="modal" href="#access-level" class="access-level">
                                <span class="fa fa-unlock fa-2x"></span> <div id="public-mode-selected"> {% trans "Everyone" %} </div>

                            </a>

                        </div>
                        <div id="recently-created" class="col-xs-12 form-group">
                            <p data-toggle="tooltip" data-placement="top" title="{% trans "It will help your friends to find your draw faster" %}">
                                <input type="checkbox" name="show_in_public_list" checked>{% trans "Show the draw in the list 'Recently created'." %}
                            </p>
                        </div>
                    </div>
                    <div id="public-draw-invite" class="col-xs-12 col-md-8 col-md-offset-2">
                        <p class="h4"> {% trans "Invite people" %}: </p>
                            <p>{% trans "An invitation will arrive to the emails you introduce below" %}</p>
                            <input type="email" id="invite-emails" class="form-control" placeholder="{% trans "Type the emails here..." %}">
                        </p>
                    </div>
                </div>
            {#% endif %#}
        {% endif %}

        <div class="col-sm-8 col-sm-offset-2">
                {% if draw_type == "LinksSetsDraw" %}
                    <div class='alert alert-info' role='alert'>{%trans 'Separate items by commas. e.g: David S, Maria, Leo, ...'%}</div>
                {% endif %}
            <!-- Errors -->
            {%for err in errors %}
                <div class="alert alert-danger text-center" role="alert">
                    <button type="button" class="close" data-dismiss="alert">&times;</button>
                    {{err}}
                </div>
            {% endfor  %}
            <!-- Input Form -->
            <div class="step-configure">
                {% if draw_type == "CoinDraw" %}
                    {% crispy draw draw.helper %}
                    <div class="text-center">
                        <input type="image" id="img-coin" src="{% static "img/img_coin/head.png" %}" name="coin">
                        <p>{% trans "Tap the coin to flip it." %}</p>
                        {% if result %}
                            <script>
                                coin.flip("{{ result.0.0 }}");
                            </script>
                        {% endif %}
                    </div>
                {% else %}
                    {% crispy draw draw.helper %}
                {% endif %}
            </div>
            <div class="col-xs-12 text-center">
                <!-- Buttons for Try, next step, cancel, toss -->
                {% if is_public %}
                    <div class="row btn-row">
                        <!-- Button to try a draw when creating a public one -->
                        <button id="try" type="submit" name="try" class="btn btn-success">{% trans 'Try it!' %}</button>
                    </div>

                    <div class="col-sm-8 col-sm-offset-2 btn-row">
                        <a href="{% url 'index' %}" class="col-xs-6 btn btn-default">{% trans 'Cancel' %}</a>
                        <button type="submit" id="next" class="col-xs-6 btn btn-primary">{% trans 'Next step' %}</button>
                    </div>
                {% else %}
                    <div class="row btn-row">
                        <!-- Button to directly toss the private draw -->
                        <button id="toss" type="submit" name="toss" class="btn btn-success">{% trans 'Toss!' %}</button>
                    </div>
                {% endif %}
            </div>
        </div>

        {# submit-type: Determine the type of submition, by default it's a toss (normal or public) #}
        <input class="hidden" name="submit-type" value="{% if is_public %}public_toss{% else %}toss{% endif %}"/>
        {# users: Sring with the emails of the users invited to the draw #}
        <input class="hidden" id="users" name="users" value="">
        {# users: show or hide the draw in the "Recently created" list #}
        <input class="hidden" type="checkbox" name="show_in_public_list" checked>
    </form>
    <!-- End Input Form -->

    {% if is_public %}
        {# Render the Modal panels options in public draws #}
        {#% if public_draw_step %} {# If user is creating the draw #}
            {# Hover panel to change the lever of restriction of the public draw (when setting it up) #}
            <div id="access-level" class="modal fade" tabindex="-1" style="display: none;" data-focus-on="input:first">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">{% trans "Restict the access to your draw" %}</h4>
                </div>
                <div class="modal-body">
                    {% include "snippets/snippet_public_draw_privacy.html" %}
                </div>
                <div class="modal-footer">
                    <button type="button" data-dismiss="modal" class="btn btn-default">{% trans "Cancel" %}</button>
                    <button id="save-change-privacy" data-dismiss="modal" type="button" class="btn btn-primary">{% trans "Save" %}</button>
                </div>
            </div>
    {% endif %}
{% endblock %}
